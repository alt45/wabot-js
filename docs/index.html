<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wabot-JS API Documentation</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1, h2, h3 { color: #0056b3; }
        pre { background-color: #f4f4f4; padding: 15px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; }
        code { font-family: 'Courier New', Courier, monospace; }
        .header { border-bottom: 2px solid #0056b3; padding-bottom: 10px; margin-bottom: 20px; }
        .endpoint { border: 1px solid #ddd; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .method { font-weight: bold; color: #fff; background-color: #28a745; padding: 5px 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Wabot-JS API Documentation</h1>
    </div>

    <h2>Authentication</h2>
    <p>All API requests must include the <code>X-API-KEY</code> header containing the secret key defined in your <code>.env</code> file.</p>
    <pre><code>X-API-KEY: your-secret-api-key</code></pre>

    <h2 id="send">Send Message</h2>
    <div class="endpoint">
        <h3><span class="method">POST</span> /send</h3>
        <p>Sends a message to a personal number or a group.</p>

        <h4>Request Body (JSON)</h4>
        <pre><code>{
  "number": "6281234567890",
  "groupId": "120363041234567890@g.us",
  "type": "text" | "image" | "document",
  "payload": {
    // Payload content varies by type
  }
}</code></pre>
        <ul>
            <li>Use <code>"number"</code> for individuals or <code>"groupId"</code> for groups. One is required.</li>
            <li><code>"type"</code> determines the message type.</li>
            <li><code>"payload"</code> contains the message details.</li>
        </ul>

        <h4>Payload Structures</h4>
        <h5>Text Message</h5>
        <pre><code>"payload": {
  "message": "Hello from the API!"
}</code></pre>

        <h5>Image Message</h5>
        <pre><code>"payload": {
  "url": "https://example.com/image.jpg",
  "caption": "This is a caption"
}</code></pre>

        <h5>Document Message</h5>
        <pre><code>"payload": {
  "url": "https://example.com/document.pdf",
  "fileName": "ImportantDocument.pdf",
  "mimetype": "application/pdf"
}</code></pre>
    </div>

    <h2>API Test Form</h2>
    <div class="endpoint">
        <form id="api-test-form">
            <div>
                <label for="api-key">API Key:</label><br>
                <input type="text" id="api-key" name="api-key" required style="width: 100%;">
            </div>
            <br>
            <div>
                <label>Recipient Type:</label><br>
                <input type="radio" id="recipient-number" name="recipient-type" value="number" checked>
                <label for="recipient-number">Number</label>
                <input type="radio" id="recipient-group" name="recipient-type" value="groupId">
                <label for="recipient-group">Group ID</label>
            </div>
            <br>
            <div>
                <label for="recipient-id">Recipient ID:</label><br>
                <input type="text" id="recipient-id" name="recipient-id" required placeholder="e.g., 6281234567890 or 123...@g.us" style="width: 100%;">
            </div>
            <br>
            <div>
                <label for="message-type">Message Type:</label><br>
                <select id="message-type" name="message-type" style="width: 100%;">
                    <option value="text">Text</option>
                    <option value="image">Image</option>
                    <option value="document">Document</option>
                </select>
            </div>
            <br>
            <div id="payload-fields">
                <!-- Fields will be dynamically inserted here -->
            </div>
            <button type="submit">Send Message</button>
        </form>
        <br>
        <h4>API Response:</h4>
        <pre id="api-response"><code>Waiting for request...</code></pre>
    </div>

    <h2>Example Usage with <code>curl</code></h2>
    <!-- ... existing curl examples ... -->
</body>
<script>
    const form = document.getElementById('api-test-form');
    const messageTypeSelector = document.getElementById('message-type');
    const payloadFieldsContainer = document.getElementById('payload-fields');
    const apiResponseContainer = document.getElementById('api-response');

    const payloadTemplates = {
        text: `
            <div>
                <label for="payload-message">Message:</label><br>
                <textarea id="payload-message" required style="width: 100%; min-height: 80px;"></textarea>
            </div>
        `,
        image: `
            <div>
                <label for="payload-url">Image URL:</label><br>
                <input type="text" id="payload-url" required style="width: 100%;">
            </div>
            <br>
            <div>
                <label for="payload-caption">Caption (optional):</label><br>
                <input type="text" id="payload-caption" style="width: 100%;">
            </div>
        `,
        document: `
            <div>
                <label for="payload-url">Document URL:</label><br>
                <input type="text" id="payload-url" required style="width: 100%;">
            </div>
            <br>
            <div>
                <label for="payload-fileName">File Name:</label><br>
                <input type="text" id="payload-fileName" required style="width: 100%;">
            </div>
            <br>
            <div>
                <label for="payload-mimetype">MIME Type (optional):</label><br>
                <input type="text" id="payload-mimetype" placeholder="e.g., application/pdf" style="width: 100%;">
            </div>
        `
    };

    function updatePayloadFields() {
        const messageType = messageTypeSelector.value;
        payloadFieldsContainer.innerHTML = payloadTemplates[messageType];
    }

    messageTypeSelector.addEventListener('change', updatePayloadFields);
    // Initial call
    updatePayloadFields();

    form.addEventListener('submit', async (event) => {
        event.preventDefault();
        
        apiResponseContainer.textContent = 'Sending...';

        const apiKey = document.getElementById('api-key').value;
        const recipientType = document.querySelector('input[name="recipient-type"]:checked').value;
        const recipientId = document.getElementById('recipient-id').value;
        const messageType = messageTypeSelector.value;

        const body = {
            type: messageType,
            payload: {}
        };

        body[recipientType] = recipientId;

        if (messageType === 'text') {
            body.payload.message = document.getElementById('payload-message').value;
        } else if (messageType === 'image') {
            body.payload.url = document.getElementById('payload-url').value;
            body.payload.caption = document.getElementById('payload-caption').value;
        } else if (messageType === 'document') {
            body.payload.url = document.getElementById('payload-url').value;
            body.payload.fileName = document.getElementById('payload-fileName').value;
            const mimetype = document.getElementById('payload-mimetype').value;
            if(mimetype) body.payload.mimetype = mimetype;
        }
        
        try {
            const response = await fetch('/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-KEY': apiKey
                },
                body: JSON.stringify(body, null, 2)
            });
            const result = await response.json();
            apiResponseContainer.textContent = JSON.stringify(result, null, 2);

        } catch (error) {
            apiResponseContainer.textContent = `Error: ${error.message}`;
        }
    });
</script>
</html>
